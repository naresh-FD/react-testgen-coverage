{"messages":[{"role":"system","content":"You are a React testing expert. You generate comprehensive Jest + React Testing Library test files for React components. Your tests are production-quality, use best practices, and achieve high code coverage."},{"role":"user","content":"Generate a comprehensive Jest + React Testing Library test file for the following React component.\nThe tests should achieve at least 50% code coverage.\nUse renderWithProviders from test-utils. Mock framer-motion and lucide-react if imported.\n\n## Source Code\n```tsx\nimport type { ReactNode } from 'react';\nimport { ArrowUp, ArrowDown } from 'lucide-react';\nimport { motion } from 'framer-motion';\nimport { Card, CardContent } from '@/components/common/Card';\nimport { Skeleton } from '@/components/common/Skeleton';\nimport { formatCurrency, formatPercentage } from '@/utils/formatters';\nimport { cn } from '@/utils/helpers';\n\ninterface StatsCardProps {\n  title: string;\n  value: number;\n  change?: number;\n  changeLabel?: string;\n  icon: ReactNode;\n  variant?: 'default' | 'income' | 'expense' | 'balance';\n  isCurrency?: boolean;\n  isLoading?: boolean;\n}\n\nexport function StatsCard({\n  title,\n  value,\n  change,\n  changeLabel = 'vs last month',\n  icon,\n  variant = 'default',\n  isCurrency = true,\n  isLoading = false,\n}: StatsCardProps) {\n  const styles = variantStyles[variant];\n  const isPositiveChange = change !== undefined && change >= 0;\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <Skeleton className=\"h-4 w-24\" />\n          <Skeleton className=\"mt-4 h-8 w-32\" />\n          <Skeleton className=\"mt-2 h-3 w-20\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }}>\n      <Card>\n        <CardContent className=\"p-6\">\n          <p className=\"text-sm font-medium text-muted-foreground\">{title}</p>\n          <div className={cn('rounded-full', styles.iconBg)}>\n            <span className={styles.iconColor}>{icon}</span>\n          </div>\n          <p className={cn('text-2xl font-bold', styles.valueColor)}>\n            {isCurrency ? formatCurrency(value) : value.toLocaleString()}\n          </p>\n          {change !== undefined && (\n            <div className=\"flex items-center gap-1\">\n              <span className={cn(isPositiveChange ? 'text-success' : 'text-destructive')}>\n                {isPositiveChange ? <ArrowUp /> : <ArrowDown />}\n                {formatPercentage(Math.abs(change))}\n              </span>\n              <span>{changeLabel}</span>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </motion.div>\n  );\n}\n\nexport default StatsCard;\n```\n\n## Test Requirements\n- Use renderWithProviders from test-utils (wraps all providers + MemoryRouter)\n- Use screen queries (getByRole, getByText, getByLabelText, getByTestId)\n- Use userEvent for interactions\n- Test: rendering, props, interactions, conditional branches\n- Provide realistic mock data\n- Each test should assert something meaningful"},{"role":"assistant","content":"import * as React from 'react';\nimport { screen } from '@testing-library/react';\nimport { renderWithProviders } from '../../../test-utils/renderWithProviders';\nimport StatsCard from '../StatsCard';\n\n// Mock framer-motion to avoid animation issues in tests\njest.mock('framer-motion', () => ({\n  motion: new Proxy({}, {\n    get: (_, tag) => {\n      const Component = (props: any) => {\n        const { initial, animate, exit, transition, ...rest } = props;\n        const Tag = typeof tag === 'string' ? tag : 'div';\n        return <Tag {...rest} />;\n      };\n      Component.displayName = `motion.${String(tag)}`;\n      return Component;\n    },\n  }),\n}));\n\n// Mock formatters\njest.mock('@/utils/formatters', () => ({\n  formatCurrency: (val: number) => `$${val.toFixed(2)}`,\n  formatPercentage: (val: number) => `${val}%`,\n}));\n\ndescribe('StatsCard', () => {\n  const defaultProps = {\n    title: 'Total Income',\n    value: 5000,\n    icon: <span data-testid=\"mock-icon\">ðŸ’°</span>,\n  };\n\n  it('renders the title and formatted value', () => {\n    renderWithProviders(<StatsCard {...defaultProps} />);\n\n    expect(screen.getByText('Total Income')).toBeInTheDocument();\n    expect(screen.getByText('$5000.00')).toBeInTheDocument();\n  });\n\n  it('renders the icon', () => {\n    renderWithProviders(<StatsCard {...defaultProps} />);\n\n    expect(screen.getByTestId('mock-icon')).toBeInTheDocument();\n  });\n\n  it('renders loading skeleton when isLoading is true', () => {\n    const { container } = renderWithProviders(\n      <StatsCard {...defaultProps} isLoading={true} />\n    );\n\n    // Should NOT render the title or value when loading\n    expect(screen.queryByText('Total Income')).not.toBeInTheDocument();\n    expect(screen.queryByText('$5000.00')).not.toBeInTheDocument();\n\n    // Should render skeletons\n    const skeletons = container.querySelectorAll('[class*=\"skeleton\"], [class*=\"Skeleton\"]');\n    expect(skeletons.length).toBeGreaterThan(0);\n  });\n\n  it('displays the change percentage when change prop is provided', () => {\n    renderWithProviders(\n      <StatsCard {...defaultProps} change={12.5} />\n    );\n\n    expect(screen.getByText('12.5%')).toBeInTheDocument();\n    expect(screen.getByText('vs last month')).toBeInTheDocument();\n  });\n\n  it('shows custom change label when provided', () => {\n    renderWithProviders(\n      <StatsCard {...defaultProps} change={5} changeLabel=\"vs last week\" />\n    );\n\n    expect(screen.getByText('vs last week')).toBeInTheDocument();\n  });\n\n  it('does not render change section when change is undefined', () => {\n    renderWithProviders(<StatsCard {...defaultProps} />);\n\n    expect(screen.queryByText('vs last month')).not.toBeInTheDocument();\n  });\n\n  it('renders raw number when isCurrency is false', () => {\n    renderWithProviders(\n      <StatsCard {...defaultProps} value={1500} isCurrency={false} />\n    );\n\n    expect(screen.getByText('1,500')).toBeInTheDocument();\n  });\n\n  it('renders negative change with down indicator styling', () => {\n    renderWithProviders(\n      <StatsCard {...defaultProps} change={-8.3} />\n    );\n\n    expect(screen.getByText('8.3%')).toBeInTheDocument();\n  });\n\n  it('matches snapshot', () => {\n    const { container } = renderWithProviders(\n      <StatsCard {...defaultProps} change={10} variant=\"income\" />\n    );\n    expect(container.firstChild).toMatchSnapshot();\n  });\n});"}]}
